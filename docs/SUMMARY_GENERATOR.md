# Task Completion Summary Generator

## Overview

The Summary Generator module ([summaryGenerator.ts](../src/lib/summaryGenerator.ts)) provides utilities for generating formatted summaries of completed tasks. These summaries can be copied and pasted into external agent management systems or databases.

## Features

- **Multiple Output Formats**: Plain Text, Markdown, JSON, CSV
- **Batch Export**: Export multiple completed tasks at once (CSV)
- **Safe Date Handling**: Graceful fallbacks for invalid dates
- **File Size Formatting**: Human-readable attachment sizes
- **Configurable Options**: Include/exclude sections as needed

## API Reference

### Types

```typescript
type SummaryFormat = 'text' | 'markdown' | 'csv' | 'json';

interface TaskSummaryOptions {
  includeSubtasks?: boolean;      // default: true
  includeNotes?: boolean;         // default: true
  includeAttachments?: boolean;   // default: true
  includeTranscription?: boolean; // default: true
  includeCreatedDate?: boolean;   // default: true
  includeTimestamps?: boolean;    // default: true
}
```

### Functions

| Function | Description |
|----------|-------------|
| `generateSummary(todo, completedBy, format?, options?)` | Unified entry point - generates summary in any format |
| `generateTaskSummary(todo, completedBy, options?)` | Plain text format with box-drawing characters |
| `generateMarkdownSummary(todo, completedBy, options?)` | Markdown with tables and checkboxes |
| `generateJSONSummary(todo, completedBy, options?)` | Structured JSON for programmatic use |
| `generateCSVSummary(todo, completedBy, options?)` | CSV with header row + data row |
| `generateBatchCSVSummary(todos[], options?)` | Multi-task CSV export |
| `generateCompactSummary(todo, completedBy)` | Single-line summary for activity logs |
| `toSummaryData(todo, completedBy)` | Convert Todo to `TaskCompletionSummaryData` |
| `copyToClipboard(text)` | Copy text to clipboard with fallback |

### Usage Examples

```typescript
import {
  generateSummary,
  copyToClipboard,
  SummaryFormat
} from '@/lib/summaryGenerator';

// Generate plain text summary
const textSummary = generateSummary(todo, 'Derrick', 'text');

// Generate markdown summary
const mdSummary = generateSummary(todo, 'Derrick', 'markdown');

// Generate JSON for API integration
const jsonSummary = generateSummary(todo, 'Derrick', 'json');

// Generate CSV for spreadsheet import
const csvSummary = generateSummary(todo, 'Derrick', 'csv');

// Copy to clipboard
const success = await copyToClipboard(textSummary);

// With custom options (exclude transcription)
const summary = generateSummary(todo, 'Derrick', 'text', {
  includeTranscription: false
});
```

## UI Integration

The `TaskCompletionSummary` component ([TaskCompletionSummary.tsx](../src/components/TaskCompletionSummary.tsx)) provides a modal interface for:

1. **Format Selection** - 4 format buttons with icons
2. **Preview/Raw Toggle** - Visual preview or raw output
3. **One-Click Copy** - Copy button with success feedback

### Component Props

```typescript
interface TaskCompletionSummaryProps {
  todo: Todo;           // The completed task
  completedBy: string;  // Username who completed
  onClose: () => void;  // Close modal callback
}
```

### Where It's Used

The component is rendered in [TodoList.tsx](../src/components/TodoList.tsx) when a task is completed:

```tsx
{showCompletionSummary && completedTaskForSummary && (
  <TaskCompletionSummary
    todo={completedTaskForSummary}
    completedBy={userName}
    onClose={() => {
      setShowCompletionSummary(false);
      setCompletedTaskForSummary(null);
    }}
  />
)}
```

## Output Format Examples

### Plain Text
```
═══════════════════════════════════════
TASK COMPLETION SUMMARY
═══════════════════════════════════════

Task: Process auto policy renewal
Status: Completed ✓
Completed By: Derrick
Completion Date: January 14, 2026 at 3:30 PM
Priority: High

SUBTASKS: 2/3 completed
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
[✓] Review coverage
[✓] Calculate premium
[○] Send quote (incomplete)

═══════════════════════════════════════
Generated by Bealer Agency Todo App
═══════════════════════════════════════
```

### Markdown
```markdown
# Task Completion Summary

## Details

| Field | Value |
|-------|-------|
| **Task** | Process auto policy renewal |
| **Status** | ✅ Completed |
| **Priority** | High |

## Subtasks (2/3)

- [x] Review coverage
- [x] Calculate premium
- [ ] Send quote

---
*Generated by Bealer Agency Todo App*
```

### JSON
```json
{
  "task": "Process auto policy renewal",
  "status": "completed",
  "completedBy": "Derrick",
  "priority": "high",
  "subtasks": {
    "total": 3,
    "completed": 2,
    "items": [...]
  },
  "generatedAt": "2026-01-14T15:30:00.000Z"
}
```

### CSV
```csv
Task,Status,Completed By,Priority,Subtasks Completed,Subtasks Total
Process auto policy renewal,Completed,Derrick,High,2,3
```

## Testing

Tests are in [summary-generator.spec.ts](../tests/summary-generator.spec.ts):

```bash
npx playwright test tests/summary-generator.spec.ts
```

## Related Files

| File | Purpose |
|------|---------|
| [summaryGenerator.ts](../src/lib/summaryGenerator.ts) | Core generator functions |
| [TaskCompletionSummary.tsx](../src/components/TaskCompletionSummary.tsx) | UI modal component |
| [TodoList.tsx](../src/components/TodoList.tsx) | Parent component integration |
| [todo.ts](../src/types/todo.ts) | Type definitions (`TaskCompletionSummaryData`) |
| [summary-generator.spec.ts](../tests/summary-generator.spec.ts) | Test suite |

## Future Enhancements

Potential improvements for the next phase:

1. **PDF Export** - Add PDF generation using `jspdf` or similar
2. **Email Integration** - Direct email sending of summaries
3. **Custom Templates** - User-defined summary templates
4. **Batch UI** - Modal for selecting multiple tasks to export
5. **Cloud Sync** - Auto-sync summaries to external systems via API
